<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Haulory.Mobile.Views.JobsCollectionPage"
    Title="Jobs">

    <Grid RowDefinitions="Auto,*" 
          Padding="16"
          RowSpacing="12">

        <!-- HEADER -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*,Auto"
              VerticalOptions="Center">

            <VerticalStackLayout Grid.Column="0" Spacing="2">
                <Label Text="Jobs"
                       FontSize="26"
                       FontAttributes="Bold" />

                <Label Text="Active deliveries"
                       FontSize="13"
                       TextColor="Gray" />
            </VerticalStackLayout>

            <Button Grid.Column="1"
                    Text=" Add Job "
                    Command="{Binding AddJobCommand}"
                    HeightRequest="40"
                    Padding="14,0"
                    CornerRadius="12"
                    BackgroundColor="{AppThemeBinding Light='#111827', Dark='#E5E7EB'}"
                    TextColor="{AppThemeBinding Light='White', Dark='Black'}" />
        </Grid>

        <!-- JOB LIST -->
        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding Jobs}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Spacing="6">
                    <Label Text="No jobs yet"
                           FontSize="16"
                           FontAttributes="Bold" />
                    <Label Text="Tap “Add Job” to create your first job."
                           FontSize="13"
                           TextColor="Gray"
                           HorizontalTextAlignment="Center" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>

                    <Border StrokeThickness="1"
                            Stroke="{AppThemeBinding Light='#E5E7EB', Dark='#374151'}"
                            BackgroundColor="{AppThemeBinding Light='#FFFFFF', Dark='#111827'}"
                            StrokeShape="RoundRectangle 16"
                            Padding="14"
                            Margin="0,0,0,12">

                        <VerticalStackLayout Spacing="12">

                            <!-- TOP ROW: Ref + reorder -->
                            <Grid ColumnDefinitions="*,Auto"
                                  VerticalOptions="Center">

                                <VerticalStackLayout Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding ReferenceNumber}"
                                           FontSize="16"
                                           FontAttributes="Bold" />

                                    <Label Text="Tap Sign Delivery when complete"
                                           FontSize="12"
                                           TextColor="Gray" />
                                </VerticalStackLayout>

                                <!-- Reorder controls -->
                                <HorizontalStackLayout Grid.Column="1"
                                                       Spacing="8"
                                                       VerticalOptions="Center">

                                    <Button Text="▲"
                                            FontSize="14"
                                            WidthRequest="38"
                                            HeightRequest="34"
                                            CornerRadius="10"
                                            Padding="0"
                                            BackgroundColor="{AppThemeBinding Light='#F3F4F6', Dark='#1F2937'}"
                                            TextColor="{AppThemeBinding Light='#111827', Dark='#E5E7EB'}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.MoveUpCommand}"
                                            CommandParameter="{Binding .}" />

                                    <Button Text="▼"
                                            FontSize="14"
                                            WidthRequest="38"
                                            HeightRequest="34"
                                            CornerRadius="10"
                                            Padding="0"
                                            BackgroundColor="{AppThemeBinding Light='#F3F4F6', Dark='#1F2937'}"
                                            TextColor="{AppThemeBinding Light='#111827', Dark='#E5E7EB'}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.MoveDownCommand}"
                                            CommandParameter="{Binding .}" />

                                </HorizontalStackLayout>
                            </Grid>

                            <!-- SUMMARY -->
                            <Label Text="{Binding CardSummary}"
                                   FontSize="13"
                                   TextColor="{AppThemeBinding Light='#4B5563', Dark='#9CA3AF'}"
                                   LineBreakMode="WordWrap" />

                            <!-- ACTIONS -->
                            <Grid ColumnDefinitions="*"
                                  RowDefinitions="Auto">

                                <Button Text="Sign Delivery"
                                        HeightRequest="42"
                                        CornerRadius="12"
                                        BackgroundColor="{AppThemeBinding Light='#2563EB', Dark='#3B82F6'}"
                                        TextColor="White"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SignDeliveryCommand}"
                                        CommandParameter="{Binding .}" />
                            </Grid>

                        </VerticalStackLayout>

                    </Border>

                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </Grid>
</ContentPage>
